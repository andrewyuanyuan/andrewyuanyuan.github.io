{"title":"JavaScript中的位操作符","date":"2021-03-22T16:00:00.000Z","date_formatted":{"ll":"Mar 23, 2021","L":"03/23/2021","MM-DD":"03-23"},"link":"2021/03/23/JavaScript/JavaScript中的位操作符","tags":["JavaScript"],"categories":["JS Technique"],"updated":"2021-03-31T16:21:03.795Z","content":"<h1 id=\"javascript中的位操作符\">JavaScript中的位操作符<a title=\"#javascript中的位操作符\" href=\"#javascript中的位操作符\"></a></h1>\n<p>**位操作符属于数值的底层操作，也就是操作内存中表示数据的的比特（位）。**ECMAScript中的所有数值都以IEEE 754 64位格式存储，但位操作并不直接应用到64位表示，而是先把值转换为32位整数，再进行位操作，之后再把结果转换为64位。对开发者而言，就好像只有32位一样，因为64位整数存储格式是不可见的。既然知道了这些，就只需要考虑32位整数即可。</p>\n<ul>\n<li>\n<p>有符号整数</p>\n<p>使用32位的前31位表示整数值。第32位表示数值的符号，如0表示正，1表示负。这一位称为<strong>符号位</strong>，它的值决定了数值其余部分的格式。</p>\n<ul>\n<li>正值：正值以真正的二进制格式存储，即31位中的每一位都代表2的幂。</li>\n<li>负值：<strong>负值以一种成为二补数（或补码）的二进制编码存储。一个数值的二补数通过如下3个步骤计算得到：</strong>\n<ol>\n<li>确定绝对值的二进制表示（e.g. 对于-18，先确定18的二进制表示）；</li>\n<li>找到数值的一补数（或反码），将每个0变成1，每个1变成0；</li>\n<li>给结果加上1</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<p>JavaScript中的位操作符有以下几个：</p>\n<ol>\n<li>\n<p>按位非<code>~</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> num1 = <span class=\"number\">25</span>; \t\t<span class=\"comment\">// 二进制00000000000000000000000000011001</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> num2 = ~num1;   <span class=\"comment\">// 二进制11111111111111111111111111100110</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(num2);  <span class=\"comment\">// -26</span></span><br></pre></td></tr></table></figure>\n<p>按位非的最终效果是对数值取反并减1，就如同<code>num2 = -num1-1</code>一样，但是位操作的速度快得多，这是因为位操作是在数值的底层表示上完成的。</p>\n</li>\n<li>\n<p>按位与<code>&amp;</code></p>\n<p><strong>按位与操作本是上就是将两个数的每一个位对齐然后基于真值表中的规则对每一位进行与操作</strong>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> result = <span class=\"number\">25</span> &amp; <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"comment\">// 11001 &amp; 00011</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(result); <span class=\"comment\">//1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>按位或<code>|</code></p>\n</li>\n<li>\n<p>按位异或<code>^</code></p>\n<p>与按位非和按位与的原理和过程大致相同，都需要将参与操作的两个数化为32位再进行操作。</p>\n</li>\n<li>\n<p>左移<code>&lt;&lt;</code></p>\n<p>左移操作符用两个小于号<code>&lt;&lt;</code>表示，会按照指定的位数将数值的所有位向左移动。e.g.  <code>2&lt;&lt;5</code>等于10向左移动5位，即1000000（二进制）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> oldValue = <span class=\"number\">2</span>;\t\t\t\t<span class=\"comment\">//等于而二进制10</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newValue = oldValue &lt;&lt; <span class=\"number\">5</span>;\t<span class=\"comment\">//二进制1000000等于十进制64</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newValue); \t\t\t<span class=\"comment\">//64</span></span><br></pre></td></tr></table></figure>\n<p>注意，左移会保留它所操作数值的符号。</p>\n</li>\n<li>\n<p>有符号右移<code>&gt;&gt;</code></p>\n<p><strong>左移的逆运算。</strong></p>\n</li>\n<li>\n<p>无符号右移<code>&gt;&gt;&gt;</code></p>\n<p>无符号右移用3个大于号表示，会将数值的所有32位都向右移动。对于正数，无符号右移与有符号右移结果相同。仍然以前面有符号右移的例子为例，64向右移5位，会变成2。</p>\n<p>对于负数，有时候差异会非常大。与有符号右移不同，无符号右移会给空位补0，而不管符号位是什么。对正数来说，这跟有符号右移效果相同；但对于负数来说，结果就差太多了，无符号右移操作符将负数的二进制表示当成整数的二进制表示来处理。因为负数是其绝对值的二补数，所有右移之后结果变得非常之大。e.g.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> oldValue = -<span class=\"number\">64</span>; <span class=\"comment\">// 等于二进制11111111111111111111111111000000，为十进制的4294967232</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newValue = oldValue &gt;&gt;&gt; <span class=\"number\">5</span>; <span class=\"comment\">// 等于十进制134217726</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<hr>\n<p>例题：<a href=\"https://leetcode-cn.com/problems/number-of-1-bits/\" target=\"_blank\">191. 位1的个数</a></p>\n<h2 id=\"方法1：循环检查二进制位\">方法1：循环检查二进制位<a title=\"#方法1：循环检查二进制位\" href=\"#方法1：循环检查二进制位\"></a></h2>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> hammingWeight = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">32</span>; i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((n&amp;(<span class=\"number\">1</span>&lt;&lt;i))!=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            result++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"方法2：位运算优化\">方法2：位运算优化<a title=\"#方法2：位运算优化\" href=\"#方法2：位运算优化\"></a></h2>\n<p>观察这个运算<code>n&amp;(n-1)</code>，其运算结果恰为把<code>n</code>的二进制位中的最低位<code>1</code>变成<code>0</code>之后的结果。</p>\n<p>e.g. <svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"38.768ex\" height=\"2.843ex\" style=\"vertical-align: -0.838ex;\" viewBox=\"0 -863.1 16691.9 1223.9\" role=\"img\" focusable=\"false\" xmlns=\"http://www.w3.org/2000/svg\" aria-labelledby=\"MathJax-SVG-1-Title\">\n<title id=\"MathJax-SVG-1-Title\">6\\&amp;(6-1)=4, 6=(110)_2, 4=(100)\\_2</title>\n<defs aria-hidden=\"true\">\n<path stroke-width=\"1\" id=\"E1-MJMAIN-36\" d=\"M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-26\" d=\"M156 540Q156 620 201 668T302 716Q354 716 377 671T401 578Q401 505 287 386L274 373Q309 285 416 148L429 132L437 142Q474 191 543 309L562 341V349Q562 368 541 376T498 385H493V431H502L626 428Q709 428 721 431H727V385H712Q688 384 669 379T639 369T618 354T603 337T591 316T578 295Q537 223 506 176T464 117T454 104Q454 102 471 85T497 62Q543 24 585 24Q618 24 648 48T682 113V121H722V112Q721 94 714 75T692 32T646 -7T574 -22Q491 -19 414 42L402 51L391 42Q312 -22 224 -22Q144 -22 93 25T42 135Q42 153 46 169T55 197T74 225T96 249T125 278T156 308L195 347L190 360Q185 372 182 382T174 411T165 448T159 491T156 540ZM361 576Q361 613 348 646T305 679Q272 679 252 649T232 572Q232 497 255 426L259 411L267 420Q361 519 361 576ZM140 164Q140 103 167 64T240 24Q271 24 304 36T356 61T374 77Q295 156 235 262L220 292L210 310L193 293Q177 277 169 268T151 229T140 164Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-28\" d=\"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-2212\" d=\"M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-31\" d=\"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-29\" d=\"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-3D\" d=\"M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-34\" d=\"M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-2C\" d=\"M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-30\" d=\"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-32\" d=\"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z\"></path>\n<path stroke-width=\"1\" id=\"E1-MJMAIN-5F\" d=\"M0 -62V-25H499V-62H0Z\"></path>\n</defs>\n<g stroke=\"currentColor\" fill=\"currentColor\" stroke-width=\"0\" transform=\"matrix(1 0 0 -1 0 0)\" aria-hidden=\"true\">\n <use xlink:href=\"#E1-MJMAIN-36\" x=\"0\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-26\" x=\"500\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-28\" x=\"1279\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-36\" x=\"1668\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-2212\" x=\"2391\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-31\" x=\"3391\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-29\" x=\"3892\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-3D\" x=\"4559\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-34\" x=\"5615\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-2C\" x=\"6116\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-36\" x=\"6561\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-3D\" x=\"7339\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-28\" x=\"8396\" y=\"0\"></use>\n<g transform=\"translate(8785,0)\">\n <use xlink:href=\"#E1-MJMAIN-31\"></use>\n <use xlink:href=\"#E1-MJMAIN-31\" x=\"500\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-30\" x=\"1001\" y=\"0\"></use>\n</g>\n<g transform=\"translate(10287,0)\">\n <use xlink:href=\"#E1-MJMAIN-29\" x=\"0\" y=\"0\"></use>\n <use transform=\"scale(0.707)\" xlink:href=\"#E1-MJMAIN-32\" x=\"550\" y=\"-213\"></use>\n</g>\n <use xlink:href=\"#E1-MJMAIN-2C\" x=\"11130\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-34\" x=\"11575\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-3D\" x=\"12354\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-28\" x=\"13410\" y=\"0\"></use>\n<g transform=\"translate(13799,0)\">\n <use xlink:href=\"#E1-MJMAIN-31\"></use>\n <use xlink:href=\"#E1-MJMAIN-30\" x=\"500\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-30\" x=\"1001\" y=\"0\"></use>\n</g>\n <use xlink:href=\"#E1-MJMAIN-29\" x=\"15301\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-5F\" x=\"15690\" y=\"0\"></use>\n <use xlink:href=\"#E1-MJMAIN-32\" x=\"16191\" y=\"0\"></use>\n</g>\n</svg>，运算结果<code>4</code>即为把<code>6</code>的二进制中的最低位的<code>1</code>变成<code>0</code>之后的结果。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> hammingWeight = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(n)&#123;</span><br><span class=\"line\">        n &amp;= (n-<span class=\"number\">1</span>);</span><br><span class=\"line\">        result++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"每日一题：LC456 132模式","link":"2021/03/24/刷题日记/每日一题：LC456 132模式"},"next":{"title":"每日一题：LC494 目标和（待补充）","link":"2021/03/23/刷题日记/每日一题：LC494 目标和（待补充）"},"plink":"http://example.com/2021/03/23/JavaScript/JavaScript中的位操作符/","toc":[{"id":"javascript中的位操作符","title":"JavaScript中的位操作符","index":"1","children":[{"id":"方法1：循环检查二进制位","title":"方法1：循环检查二进制位","index":"1.1"},{"id":"方法2：位运算优化","title":"方法2：位运算优化","index":"1.2"}]}]}